### 服务发现


- 服务发现其关键组件是服务注册表，他就是一个包含服务实例网络位置信息的一个数据库

-  类库封装，实现不同模块方法调用组装复用指令程序，链接器将代码的符号引用转换为模块入口或进程内存地址的直接引用
- 服务化的普及，软件分布在网络上的不同机器相互协调作来复用公共，如何确定目标的确切位置，解决该问题的过程便是 **服务发现 Service  Discovery**  

- 权限定名+端口号+服务标识     --->   精确定位远程服务坐标
	- 全限定名代表了网络中某台主机的精确位置
	- 端口代表主机 TCP/UDP 网络服务的程序
	- 服务标识代表了程序所提供的的某个具体的方法入口

	- 全限定名+端口号 对所有远程服务都一致
	- 服务标识 与具体的应用层协议相关
		- REST的远程服务  标识URL地址
		- RMI的远程服务 标识是Stub类中的方法
		- SOAP的远程服务 标识是WSDL中定义的方法
	    - 两种方式 UDDI/DNS  

- #### 服务发现的过程
	- 服务注册
		- 服务启动，将自己信息表表通知服务中心分 自注册模式，和 k8s 第三方注册模式 
	- 服务的维护
		- 支持多种协议  http tcp
		- 多种方式 长链接 心跳 探针 进程状态
	- 服务发现
		- DNS Lookup 、HTTAPI
		- 负载均衡、流量管理、键值管理、 元数据管理、业务分组
	- 可靠与可用的权衡


#### 注册中心实现
- 可用性与一致性的矛盾，权衡利弊使用
- 实现服务注册中心的三类目标工具
	- 分布式KV存储框架 ZK(zab算法)、etcd(raft算法)、Doozerd    CP
	- 以基础设施来实现服务发现(主要是 DNS) SkyDNS CoreDNS,不受技术约束，但是监控相对复杂些
	- 专门的服务发现框架 Eureka 、Consul、Nacos
		- Consul CP,Eureka AP,Nacos 能支持 CP AP ，是二选一
		- Eureka 优先保证高可用 各节点采用异步复制  ,ribbon hystrix 故障转移（failover） 快速失败（failfast） 
		- Consul 的选择是优先保证高可靠性 一致性，相对牺牲系统服务发现的可用性。Consul 采用Raft 算法 票；同时采用 Gossip 协议，支持多数据中心之间更大规模的服务同步 