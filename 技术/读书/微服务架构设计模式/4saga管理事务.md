#### saga事务 [[事务处理]]


#### 分布式事务的挑战
- 多个服务、数据库、消息代理之间维持数据一致性的传统方式就是采用分布式事务
- 分布式事务管理的事实标准 XA 两阶段提交
- Java JTA
- NoSQL（mongoDB cassandra） [[rabbitmq]]  [[kafka]] 不支持分布式事务
- CAP 理论  一致性 可用性 分区容忍性 AP  CP，通常情况 AP

#### SAGA
- 有一串本地事务组成，本地事务 ACID
- SAGA 缺少事务的隔离性 ACD
- 消息驱动，前一个事务 触发下一个事务
- 挑战
	- 回滚 撤销，每个事务都要有补偿机制
- 协调模式
	- 协同式 choreography
		- 可靠的通信
		- 好处
			- 简单
			- 松耦合
		- 弊端
			- 难理解
			- 服务循环依赖
	- 编排式 orchestration
		- 编排器视为一个状态机
		- 好处
			- 更简单的依赖关系
			- 较少的耦合
			- 改善关注隔离，简化业务逻辑
- 隔离问题
	- 缺乏隔离导致的问题
		- 丢失更新
		- 脏读
		- 模糊或不可重复读
	- 对策
		- 语义锁
		- 交换式更新
		- 悲观视图
		- 重读值
		- 版本文件
		- 业务风险评估